<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compras - Sistema de Ventas Minimarket</title>
    
    <!-- CSS Global -->
    <link rel="stylesheet" href="../../../public/assets/css/styles.css">
    <!-- CSS del M√≥dulo -->
    <link rel="stylesheet" href="purchases.css">
</head>
<body>
    <div class="purchases-container">
        <!-- Header del M√≥dulo -->
        <div class="module-header">
            <div class="header-content">
                <div class="header-info">
                    <h1 class="module-title">Gesti√≥n de Compras</h1>
                    <p class="module-subtitle">Administra las compras y proveedores del minimarket</p>
                </div>
                <div class="header-actions">
                    <button id="newPurchaseBtn" class="btn btn-primary">
                        <span class="btn-icon">‚ûï</span>
                        Nueva Compra
                    </button>
                    <button id="exportPurchasesBtn" class="btn btn-secondary">
                        <span class="btn-icon">üìä</span>
                        Exportar
                    </button>
                    <button id="refreshTableBtn" class="btn btn-outline">
                        <span class="btn-icon">üîÑ</span>
                        Actualizar
                    </button>
                </div>
            </div>
        </div>

        <!-- Filtros y B√∫squeda -->
        <div class="filters-section">
            <div class="filters-row">
                <div class="search-box">
                    <input type="text" id="purchaseSearch" placeholder="Buscar por n√∫mero, proveedor o producto...">
                    <button id="searchBtn" class="search-btn">üîç</button>
                </div>
                
                <div class="filter-group">
                    <select id="statusFilter" class="filter-select">
                        <option value="">Todos los estados</option>
                        <option value="pending">Pendiente</option>
                        <option value="received">Recibida</option>
                        <option value="partial">Parcial</option>
                        <option value="cancelled">Cancelada</option>
                    </select>
                    
                    <select id="supplierFilter" class="filter-select">
                        <option value="">Todos los proveedores</option>
                    </select>
                    
                    <select id="dateFilter" class="filter-select">
                        <option value="">Todas las fechas</option>
                        <option value="today">Hoy</option>
                        <option value="week">Esta semana</option>
                        <option value="month">Este mes</option>
                        <option value="quarter">Este trimestre</option>
                    </select>
                    
                    <input type="date" id="dateFromFilter" class="filter-input">
                    <input type="date" id="dateToFilter" class="filter-input">
                    
                    <button id="clearFiltersBtn" class="btn btn-outline">Limpiar</button>
                </div>
            </div>
        </div>

        <!-- Estad√≠sticas R√°pidas -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">üì¶</div>
                <div class="stat-content">
                    <div class="stat-value" id="totalPurchases">0</div>
                    <div class="stat-label">Total Compras</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">üí∞</div>
                <div class="stat-content">
                    <div class="stat-value" id="totalValue">S/ 0.00</div>
                    <div class="stat-label">Valor Total</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚è≥</div>
                <div class="stat-content">
                    <div class="stat-value" id="pendingPurchases">0</div>
                    <div class="stat-label">Pendientes</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">‚úÖ</div>
                <div class="stat-content">
                    <div class="stat-value" id="receivedPurchases">0</div>
                    <div class="stat-label">Recibidas</div>
                </div>
            </div>
        </div>

        <!-- Tabla de Compras -->
        <div class="table-container">
            <div class="table-header">
                <div class="table-actions">
                    <label class="checkbox-container">
                        <input type="checkbox" id="selectAllPurchases">
                        <span class="checkmark"></span>
                        Seleccionar todo
                    </label>
                </div>
                <div class="table-info">
                    <span id="selectedCount">0 seleccionadas</span>
                </div>
            </div>
            
            <div class="table-wrapper">
                <table class="purchases-table">
                    <thead>
                        <tr>
                            <th width="40"></th>
                            <th class="sortable" data-sort="number">
                                N¬∞ Compra <span class="sort-icon">‚ÜïÔ∏è</span>
                            </th>
                            <th class="sortable" data-sort="supplier">
                                Proveedor <span class="sort-icon">‚ÜïÔ∏è</span>
                            </th>
                            <th class="sortable" data-sort="date">
                                Fecha <span class="sort-icon">‚ÜïÔ∏è</span>
                            </th>
                            <th class="sortable" data-sort="deliveryDate">
                                Entrega <span class="sort-icon">‚ÜïÔ∏è</span>
                            </th>
                            <th class="sortable" data-sort="total">
                                Total <span class="sort-icon">‚ÜïÔ∏è</span>
                            </th>
                            <th class="sortable" data-sort="status">
                                Estado <span class="sort-icon">‚ÜïÔ∏è</span>
                            </th>
                            <th width="120">Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="purchasesTableBody">
                        <!-- Las compras se cargar√°n din√°micamente -->
                    </tbody>
                </table>
            </div>
            
            <!-- Paginaci√≥n -->
            <div class="pagination-container">
                <div class="pagination-info">
                    <span id="paginationInfo">Mostrando 0-0 de 0 compras</span>
                </div>
                <div class="pagination-controls">
                    <button id="firstPageBtn" class="pagination-btn">‚èÆÔ∏è</button>
                    <button id="prevPageBtn" class="pagination-btn">‚¨ÖÔ∏è</button>
                    <div id="paginationNumbers" class="pagination-numbers"></div>
                    <button id="nextPageBtn" class="pagination-btn">‚û°Ô∏è</button>
                    <button id="lastPageBtn" class="pagination-btn">‚è≠Ô∏è</button>
                </div>
                <div class="pagination-size">
                    <select id="pageSizeSelect">
                        <option value="10">10 por p√°gina</option>
                        <option value="25" selected>25 por p√°gina</option>
                        <option value="50">50 por p√°gina</option>
                        <option value="100">100 por p√°gina</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Loader -->
        <div id="purchasesLoader" class="loader hidden">
            <div class="loader-spinner"></div>
            <p>Cargando compras...</p>
        </div>
    </div>

    <!-- Modal Nueva/Editar Compra -->
    <div id="purchaseModal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="purchaseModalTitle">Nueva Compra</h2>
                <button id="closePurchaseModalBtn" class="modal-close">‚úï</button>
            </div>
            
            <form id="purchaseForm" class="modal-body">
                <div class="form-grid">
                    <!-- Informaci√≥n General -->
                    <div class="form-section">
                        <h3>Informaci√≥n General</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="purchaseNumber">N¬∞ de Compra *</label>
                                <input type="text" id="purchaseNumber" readonly>
                            </div>
                            <div class="form-group">
                                <label for="purchaseDate">Fecha de Compra *</label>
                                <input type="date" id="purchaseDate" required>
                            </div>
                            <div class="form-group">
                                <label for="deliveryDate">Fecha de Entrega</label>
                                <input type="date" id="deliveryDate">
                            </div>
                        </div>
                    </div>

                    <!-- Informaci√≥n del Proveedor -->
                    <div class="form-section">
                        <h3>Proveedor</h3>
                        <div class="form-row">
                            <div class="form-group flex-2">
                                <label for="supplierSearch">Buscar Proveedor</label>
                                <div class="input-group">
                                    <input type="text" id="supplierSearch" placeholder="Buscar por nombre, RUC o tel√©fono">
                                    <button type="button" id="searchSupplierBtn" class="btn btn-outline">Buscar</button>
                                    <button type="button" id="newSupplierBtn" class="btn btn-primary">Nuevo</button>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="supplierName">Nombre/Raz√≥n Social *</label>
                                <input type="text" id="supplierName" required>
                            </div>
                            <div class="form-group">
                                <label for="supplierRuc">RUC</label>
                                <input type="text" id="supplierRuc" maxlength="11">
                            </div>
                            <div class="form-group">
                                <label for="supplierPhone">Tel√©fono</label>
                                <input type="tel" id="supplierPhone">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group flex-2">
                                <label for="supplierAddress">Direcci√≥n</label>
                                <input type="text" id="supplierAddress">
                            </div>
                            <div class="form-group">
                                <label for="supplierEmail">Email</label>
                                <input type="email" id="supplierEmail">
                            </div>
                        </div>
                    </div>

                    <!-- Productos -->
                    <div class="form-section">
                        <h3>Productos</h3>
                        <div class="products-header">
                            <button type="button" id="addProductBtn" class="btn btn-primary">
                                <span class="btn-icon">‚ûï</span>
                                Agregar Producto
                            </button>
                        </div>
                        <div class="products-table-container">
                            <table class="products-table">
                                <thead>
                                    <tr>
                                        <th>Producto</th>
                                        <th width="100">Cantidad</th>
                                        <th width="120">Precio Unit.</th>
                                        <th width="100">Descuento</th>
                                        <th width="120">Subtotal</th>
                                        <th width="80">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody id="purchaseProductsBody">
                                    <!-- Los productos se cargar√°n din√°micamente -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Observaciones -->
                    <div class="form-section">
                        <h3>Observaciones</h3>
                        <div class="form-row">
                            <div class="form-group full-width">
                                <label for="purchaseNotes">Notas adicionales</label>
                                <textarea id="purchaseNotes" rows="3" placeholder="Observaciones sobre la compra..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Totales -->
                    <div class="form-section">
                        <div class="totals-container">
                            <div class="totals-row">
                                <span>Subtotal:</span>
                                <span id="purchaseSubtotal">S/ 0.00</span>
                            </div>
                            <div class="totals-row">
                                <span>Descuento:</span>
                                <span id="purchaseDiscount">S/ 0.00</span>
                            </div>
                            <div class="totals-row">
                                <span>IGV (18%):</span>
                                <span id="purchaseIgv">S/ 0.00</span>
                            </div>
                            <div class="totals-row total">
                                <span>Total:</span>
                                <span id="purchaseTotal">S/ 0.00</span>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            
            <div class="modal-footer">
                <button type="button" id="cancelPurchaseBtn" class="btn btn-secondary">Cancelar</button>
                <button type="button" id="savePurchaseBtn" class="btn btn-primary">Guardar Compra</button>
            </div>
        </div>
    </div>

    <!-- Modal Selecci√≥n de Producto -->
    <div id="productSelectionModal" class="modal hidden">
        <div class="modal-content medium">
            <div class="modal-header">
                <h2>Seleccionar Producto</h2>
                <button id="closeProductSelectionBtn" class="modal-close">‚úï</button>
            </div>
            
            <div class="modal-body">
                <div class="search-section">
                    <input type="text" id="productSearchInput" placeholder="Buscar productos...">
                </div>
                <div id="productsList" class="products-list">
                    <!-- Los productos se cargar√°n din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Vista de Compra -->
    <div id="viewPurchaseModal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>Compra <span id="viewPurchaseNumber"></span></h2>
                <div class="modal-actions">
                    <button id="printPurchaseBtn" class="btn btn-outline">üñ®Ô∏è Imprimir</button>
                    <button id="emailPurchaseBtn" class="btn btn-outline">üìß Enviar</button>
                </div>
                <button id="closeViewPurchaseBtn" class="modal-close">‚úï</button>
            </div>
            
            <div class="modal-body">
                <div id="purchasePreview" class="purchase-preview">
                    <!-- La vista previa se cargar√° din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="../../utils/config.js"></script>
    <script src="../../utils/helpers.js"></script>
    <script src="../../services/api.service.js"></script>
    <script src="purchases.js"></script>
</body>
</html>